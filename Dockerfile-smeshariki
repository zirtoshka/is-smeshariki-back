FROM amazoncorretto:21-alpine-jdk AS build
WORKDIR /workspace

COPY pom.xml .
COPY mvnw .
COPY .mvn .mvn
COPY src src

RUN ./mvnw -B clean package -DskipTests

FROM amazoncorretto:21-alpine-jre
WORKDIR /app
COPY --from=build /workspace/target/smeshariki-back-0.0.1-SNAPSHOT.war /app/smeshariki-back-0.0.1-SNAPSHOT.war
EXPOSE 8081
CMD ["java", "-jar", "/app/smeshariki-back-0.0.1-SNAPSHOT.war"]
